#!/bin/sh
#
# `fullpath`: Get full path of a file with symbolic links resolved. Like
#             `realpath(1)` but using only POSIX `sh`.
#
# Depends: none
# Environment: none

error () {
	printf '%s: %s\n' "${0##*/}" "$1"
	exit 1
}

main ()
{
	if [ $# -eq 0 ]; then
		while read -r arg; do
			set -- "$@" "$arg"
		done
	fi

	for arg do
		f="$arg"
		[ -e "$f" ] || error "$f not found"

		if [ -d "$f" ]; then
			f="$(cd "$f" >/dev/null && pwd -P)"
		else
			case "$f" in
				*/*) cd "${f%/*}" >/dev/null || return 1
			esac

			f="$(pwd -P)/${f##*/}"
		fi

		printf '%s\n' "$f"
	done
}

main "$@"

